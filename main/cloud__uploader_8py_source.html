<html><head><meta http-equiv="Content-Type" content="text/html;charset=utf-8">
<title>main: cloud_uploader.py Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
<script type="text/javascript" src="jquery.js"></script>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.8.11 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
    </ul>
  </div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">cloud_uploader.py</div>  </div>
</div><!--header-->
<div class="contents">
<a href="cloud__uploader_8py.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno"><a class="line" href="namespacesrc_1_1cloud__uploader.html">    1</a></span>&#160;<span class="comment">#!/usr/bin/python</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="stringliteral">BLACKBOX</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="stringliteral">Version 0.0.1, March 2019</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="stringliteral">http://rosin-project.eu/ftp/blackbox</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="stringliteral">Copyright (c) 2019 PPM Robotics AS</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="stringliteral">This library is part of BLACKBOX project,</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="stringliteral">the Focused Technical Project BLACKBOX - an automated trigger-based </span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="stringliteral">reporting, data recording and playback unit for ROS</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="stringliteral">is co-financed by the EU project ROSIN (www.rosin-project.eu)</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="stringliteral">and ROS-Industrial initiative (www.rosindustrial.eu).</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="stringliteral">Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="stringliteral">you may not use this file except in compliance with the License.</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="stringliteral">You may obtain a copy of the License at</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="stringliteral">    http://www.apache.org/licenses/LICENSE-2.0</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="stringliteral">Unless required by applicable law or agreed to in writing, software</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="stringliteral">distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="stringliteral">WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="stringliteral">See the License for the specific language governing permissions and</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="stringliteral">limitations under the License.</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="keyword">import</span> rospy</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="keyword">import</span> urllib2</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="keyword">import</span> json</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="keyword">import</span> argparse</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="keyword">import</span> ConfigParser, os</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="keyword">import</span> ftplib</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="keyword">import</span> time</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="keyword">from</span> smtplib <span class="keyword">import</span> SMTP</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="keyword">import</span> datetime</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="keyword">import</span> Queue</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="keyword">import</span> shutil</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="keyword">import</span> os</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="keyword">import</span> sys</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="keyword">from</span> os.path <span class="keyword">import</span> expanduser</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="keyword">from</span> ros_node_base <span class="keyword">import</span> RosNodeBase</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="keyword">from</span> threading <span class="keyword">import</span> Thread    </div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="keyword">from</span> blackbox_control.srv <span class="keyword">import</span> GetAvailableRange, Export</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="keyword">from</span> blackbox_main.msg <span class="keyword">import</span> UploadStatus, UploadStatusList</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="keyword">from</span> blackbox_main.srv <span class="keyword">import</span> Upload, UploadResponse</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="keyword">from</span> email.mime.multipart <span class="keyword">import</span> MIMEMultipart</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="keyword">from</span> email.mime.text <span class="keyword">import</span> MIMEText</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="comment">## Uploads files to an FTP server</span></div><div class="line"><a name="l00053"></a><span class="lineno"><a class="line" href="classsrc_1_1cloud__uploader_1_1CloudUploader.html">   53</a></span>&#160;<span class="keyword">class </span><a class="code" href="classsrc_1_1cloud__uploader_1_1CloudUploader.html">CloudUploader</a>(RosNodeBase):</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    <span class="comment">## Initalizes the class</span></div><div class="line"><a name="l00056"></a><span class="lineno"><a class="line" href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#a84d3c140aaad17a4555fb79807769b4e">   56</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#a84d3c140aaad17a4555fb79807769b4e">__init__</a>(self):</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;        <span class="comment">## The id of the node, used in logs</span></div><div class="line"><a name="l00058"></a><span class="lineno"><a class="line" href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#ae21dd62eb0c05e385e497e6d4e16fe22">   58</a></span>&#160;        self.<a class="code" href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#ae21dd62eb0c05e385e497e6d4e16fe22">node_id</a> = <span class="stringliteral">&quot;BBU&quot;</span></div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;        <span class="comment">## The upload queue</span></div><div class="line"><a name="l00060"></a><span class="lineno"><a class="line" href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#ab0204c1b5902f8228dc6c3fe5b49cf1d">   60</a></span>&#160;        self.<a class="code" href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#ab0204c1b5902f8228dc6c3fe5b49cf1d">queue</a> = Queue.Queue()</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;        <span class="comment">## The current task, already removed from the queue.</span></div><div class="line"><a name="l00062"></a><span class="lineno"><a class="line" href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#a8c0ce240525b68bdbcbefb94b52c7716">   62</a></span>&#160;        self.<a class="code" href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#a8c0ce240525b68bdbcbefb94b52c7716">currentTask</a> = <span class="keywordtype">None</span></div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    <span class="comment">## Formats a log message</span></div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    <span class="comment"># @param type The type of the message. Possibilities: (&#39;e&#39;, &#39;w&#39;, &#39;i&#39;). Others are treated as errors.</span></div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    <span class="comment"># @param msg The message to be printed.</span></div><div class="line"><a name="l00067"></a><span class="lineno"><a class="line" href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#a75a43889d4b8c9c504267ec21e4a585d">   67</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#a75a43889d4b8c9c504267ec21e4a585d">formatted_log</a>(self, type, msg):</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;        RosNodeBase._formatted_log(self, type, msg, self.<a class="code" href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#ae21dd62eb0c05e385e497e6d4e16fe22">node_id</a>)</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    <span class="comment">## Loads and checks the config values from rosparam</span></div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    <span class="comment">#</span></div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    <span class="comment"># If recommended elements are mising, shows a warning. This will make email sending impossible.</span></div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    <span class="comment"># If mandatory elements are missing, shows an error end exits the program.</span></div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    <span class="comment"># Some params are none of these, they already have default values that are acceptable.</span></div><div class="line"><a name="l00075"></a><span class="lineno"><a class="line" href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#a06c9310aef0ce0915b402d62d4e6c047">   75</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#a06c9310aef0ce0915b402d62d4e6c047">load_config</a>(self):</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;        <span class="comment"># Gets a rospy param with namespace</span></div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;        <span class="keyword">def </span>gp(key, def_val):</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;            <span class="keywordflow">return</span> rospy.get_param(RosNodeBase._ns(self, key), def_val)</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;        <span class="comment">#read ftp settings</span></div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;        <span class="comment">## The host address of the FTP</span></div><div class="line"><a name="l00082"></a><span class="lineno"><a class="line" href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#acf4eeda64b4446e8ba832701460b7546">   82</a></span>&#160;        self.<a class="code" href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#acf4eeda64b4446e8ba832701460b7546">ftp_host</a>= gp(<span class="stringliteral">&quot;ftp_host&quot;</span>, <span class="keywordtype">None</span>)</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;        <span class="comment">## The password of the FTP</span></div><div class="line"><a name="l00084"></a><span class="lineno"><a class="line" href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#a7710c2898f7724e6da538a14f08d5bb0">   84</a></span>&#160;        self.<a class="code" href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#a7710c2898f7724e6da538a14f08d5bb0">ftp_password</a>= gp(<span class="stringliteral">&quot;ftp_password&quot;</span>, <span class="keywordtype">None</span>)</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;        <span class="comment">## The username of the FTP</span></div><div class="line"><a name="l00086"></a><span class="lineno"><a class="line" href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#af9c85c8546a43561734e2d42a04261b9">   86</a></span>&#160;        self.<a class="code" href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#af9c85c8546a43561734e2d42a04261b9">ftp_username</a>= gp(<span class="stringliteral">&quot;ftp_username&quot;</span>, <span class="keywordtype">None</span>)</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;        <span class="comment">#read smtp settings</span></div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;        <span class="comment">## The host address of the SMTP server</span></div><div class="line"><a name="l00090"></a><span class="lineno"><a class="line" href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#a2cdbf6b5f52ec0aa4485f93af144a9c6">   90</a></span>&#160;        self.<a class="code" href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#a2cdbf6b5f52ec0aa4485f93af144a9c6">smtp_host</a> = gp(<span class="stringliteral">&quot;smtp_host&quot;</span>, <span class="keywordtype">None</span>)</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;        <span class="comment">## The username of the SMTP server</span></div><div class="line"><a name="l00092"></a><span class="lineno"><a class="line" href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#a42453bf465115f3c6acd94c8c323991c">   92</a></span>&#160;        self.<a class="code" href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#a42453bf465115f3c6acd94c8c323991c">smtp_username</a> = gp(<span class="stringliteral">&quot;smtp_username&quot;</span>, <span class="keywordtype">None</span>)</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;        <span class="comment">## The password of the SMTP server</span></div><div class="line"><a name="l00094"></a><span class="lineno"><a class="line" href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#aa825f2ae2c1ad79c43902d40f5c99844">   94</a></span>&#160;        self.<a class="code" href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#aa825f2ae2c1ad79c43902d40f5c99844">smtp_password</a> = gp(<span class="stringliteral">&quot;smtp_password&quot;</span>, <span class="keywordtype">None</span>)</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;        <span class="comment">## The connection mode of the SMTP server</span></div><div class="line"><a name="l00096"></a><span class="lineno"><a class="line" href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#a8a6cffd7993ebc45d34fd27a06e5a2ee">   96</a></span>&#160;        self.<a class="code" href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#a8a6cffd7993ebc45d34fd27a06e5a2ee">smtp_connection_mode</a> = gp(<span class="stringliteral">&quot;smtp_connection_mode&quot;</span>, <span class="stringliteral">&quot;tls&quot;</span>)</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;        <span class="comment">## The port of the SMTP server</span></div><div class="line"><a name="l00098"></a><span class="lineno"><a class="line" href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#a4f8db825ceb6b2e2b15cefa896180ff3">   98</a></span>&#160;        self.<a class="code" href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#a4f8db825ceb6b2e2b15cefa896180ff3">smtp_port</a> = gp(<span class="stringliteral">&quot;smtp_port&quot;</span>, 25)</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;        <span class="comment">## The path where the archive files are stored</span></div><div class="line"><a name="l00101"></a><span class="lineno"><a class="line" href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#a7947d11cf6ec52dcf2dd3d0bfa8b8a4a">  101</a></span>&#160;        self.<a class="code" href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#a7947d11cf6ec52dcf2dd3d0bfa8b8a4a">archive_path</a> = gp(<span class="stringliteral">&quot;archive_path&quot;</span>, <span class="keywordtype">None</span>)</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;        <span class="comment">#read email settings</span></div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;        <span class="comment">## The address where the emails should be sent</span></div><div class="line"><a name="l00105"></a><span class="lineno"><a class="line" href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#a5e588db2a8b38584a6c5e6c3713daa8b">  105</a></span>&#160;        self.<a class="code" href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#a5e588db2a8b38584a6c5e6c3713daa8b">email_toaddress</a> = gp(<span class="stringliteral">&quot;email_toaddress&quot;</span>, <span class="keywordtype">None</span>)</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;        <span class="comment">## The body of the emails to be sent</span></div><div class="line"><a name="l00107"></a><span class="lineno"><a class="line" href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#a91d12c0141a1778d94d63e63afc87d01">  107</a></span>&#160;        self.<a class="code" href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#a91d12c0141a1778d94d63e63afc87d01">email_body</a> = gp(<span class="stringliteral">&quot;email_body&quot;</span>, <span class="stringliteral">&quot;Dear user,&lt;br /&gt;{0} topic (value: {2}) triggered a new notification for you.&lt;br /&gt;The new log file is uploaded to the storage: {1}&lt;br /&gt;Best regards,&lt;br /&gt;Black Box&quot;</span>)</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;        <span class="comment">## The subject of the emails to be sent</span></div><div class="line"><a name="l00109"></a><span class="lineno"><a class="line" href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#a26e3194af13c00728bdeb9abab957cdd">  109</a></span>&#160;        self.<a class="code" href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#a26e3194af13c00728bdeb9abab957cdd">email_subject</a> = gp(<span class="stringliteral">&quot;email_subject&quot;</span>, <span class="stringliteral">&quot;New log file uploaded&quot;</span>)</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;        self.<a class="code" href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#a75a43889d4b8c9c504267ec21e4a585d">formatted_log</a>(<span class="stringliteral">&#39;i&#39;</span>, <span class="stringliteral">&#39;Config loaded&#39;</span>)</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;        </div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;        RosNodeBase._check_config(self, self.<a class="code" href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#ae21dd62eb0c05e385e497e6d4e16fe22">node_id</a>, </div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;                                    mandatory = [<span class="stringliteral">&quot;ftp_host&quot;</span>, <span class="stringliteral">&quot;ftp_username&quot;</span>, <span class="stringliteral">&quot;archive_path&quot;</span>], </div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;                                    recommended = [<span class="stringliteral">&quot;smtp_host&quot;</span>, <span class="stringliteral">&quot;smtp_username&quot;</span>, <span class="stringliteral">&quot;smtp_password&quot;</span>, <span class="stringliteral">&quot;smtp_port&quot;</span>, <span class="stringliteral">&quot;email_toadress&quot;</span>])</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    <span class="comment">## Sends an email</span></div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    <span class="comment"># @param archivename The name of the archive file</span></div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    <span class="comment"># @param topic The name of the topic that caused this mail sending</span></div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    <span class="comment"># @param value The value of the topic that caused this mail sending</span></div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    <span class="comment"># @param subject The subject of the email</span></div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    <span class="comment"># @param body The body of the email</span></div><div class="line"><a name="l00123"></a><span class="lineno"><a class="line" href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#a3242328c8d8a617c39b074cf3eecc8c6">  123</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#a3242328c8d8a617c39b074cf3eecc8c6">send_mail</a>(self, archivename, topic, value, subject, body):</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;        <span class="keywordflow">try</span>:</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;            <span class="comment">#create a message and setup the headers</span></div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;            msg = MIMEMultipart()</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;            msg[<span class="stringliteral">&#39;From&#39;</span>] = self.<a class="code" href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#a42453bf465115f3c6acd94c8c323991c">smtp_username</a></div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;            msg[<span class="stringliteral">&#39;To&#39;</span>] = self.<a class="code" href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#a5e588db2a8b38584a6c5e6c3713daa8b">email_toaddress</a></div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;            msg[<span class="stringliteral">&#39;Subject&#39;</span>] = subject</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;            msg.attach(MIMEText(body.format(topic, archivename, value), <span class="stringliteral">&#39;html&#39;</span>))</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;            <span class="comment">#connect to the smtp server</span></div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;            server = SMTP(self.<a class="code" href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#a2cdbf6b5f52ec0aa4485f93af144a9c6">smtp_host</a>, self.<a class="code" href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#a4f8db825ceb6b2e2b15cefa896180ff3">smtp_port</a>)</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;            <span class="comment">#use TLS</span></div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;            server.ehlo()</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;            server.starttls()</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;            server.ehlo()</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;            <span class="comment">#login</span></div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;            server.login(self.<a class="code" href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#a42453bf465115f3c6acd94c8c323991c">smtp_username</a>, self.<a class="code" href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#aa825f2ae2c1ad79c43902d40f5c99844">smtp_password</a>)</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;            text = msg.as_string()</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;            <span class="comment">#send mail</span></div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;            res = server.sendmail(self.<a class="code" href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#a42453bf465115f3c6acd94c8c323991c">smtp_username</a>, self.<a class="code" href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#a5e588db2a8b38584a6c5e6c3713daa8b">email_toaddress</a>, text)</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;            <span class="keywordflow">if</span> len(res) <span class="keywordflow">is</span> <span class="keywordflow">not</span> 0:</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;                self.<a class="code" href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#a75a43889d4b8c9c504267ec21e4a585d">formatted_log</a>(<span class="stringliteral">&#39;w&#39;</span>, <span class="stringliteral">&#39;SMTP sendmail returned: &#39;</span> + str(res))</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;        <span class="keywordflow">except</span> Exception <span class="keyword">as</span> inst:</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;            self.<a class="code" href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#a75a43889d4b8c9c504267ec21e4a585d">formatted_log</a>(<span class="stringliteral">&#39;w&#39;</span>, <span class="stringliteral">&#39;Cannot notify the user: {0}, {1}&#39;</span>.format(self.<a class="code" href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#a5e588db2a8b38584a6c5e6c3713daa8b">email_toaddress</a>, subject))  </div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;            self.<a class="code" href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#a75a43889d4b8c9c504267ec21e4a585d">formatted_log</a>(<span class="stringliteral">&#39;w&#39;</span>, str(type(inst)) + <span class="stringliteral">&#39; &#39;</span> + str(inst))</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    <span class="comment">## Uploads a file to an FTP and sends email containing the details</span></div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    <span class="comment"># @param task The details of the actions to perform</span></div><div class="line"><a name="l00150"></a><span class="lineno"><a class="line" href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#a4f8cbbdde6c6c65526ccb3d7b5e15197">  150</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#a4f8cbbdde6c6c65526ccb3d7b5e15197">upload_and_notify</a>(self, task):</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;        <span class="keywordflow">try</span>:</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;            <span class="comment">#create an ftp session</span></div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;            session = ftplib.FTP(self.<a class="code" href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#acf4eeda64b4446e8ba832701460b7546">ftp_host</a>, self.<a class="code" href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#af9c85c8546a43561734e2d42a04261b9">ftp_username</a>, str(self.<a class="code" href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#a7710c2898f7724e6da538a14f08d5bb0">ftp_password</a>))</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;            path = <span class="stringliteral">&#39;{0}/{1}&#39;</span>.format(self.<a class="code" href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#a7947d11cf6ec52dcf2dd3d0bfa8b8a4a">archive_path</a>, task.filename)</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;            <span class="comment"># file to send</span></div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;            with open(path,<span class="stringliteral">&#39;rb&#39;</span>) <span class="keyword">as</span> file:</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;                <span class="comment"># send the file</span></div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;                session.storbinary(<span class="stringliteral">&#39;STOR {0}&#39;</span>.format(task.filename), file)    </div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;            <span class="comment">#************************************************</span></div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;            <span class="comment"># Uncomment to enable a simulated slow connection</span></div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;            <span class="comment">#self.formatted_log(&#39;w&#39;, &quot;sleep start&quot;)</span></div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;            <span class="comment">#time.sleep(3)</span></div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;            <span class="comment">#self.formatted_log(&#39;w&#39;, &quot;sleep end&quot;)</span></div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;            <span class="comment">#************************************************</span></div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;            <span class="comment"># close the FTP</span></div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;            session.quit()</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;            <span class="comment"># Checks, if the config values for sending an email are available.</span></div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;            <span class="keywordflow">if</span> <span class="keywordflow">not</span> RosNodeBase._recommended_missing:</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;                <span class="comment">#notify the user with email</span></div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;                self.<a class="code" href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#a3242328c8d8a617c39b074cf3eecc8c6">send_mail</a>(task.filename, task.topic, task.value, self.<a class="code" href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#a26e3194af13c00728bdeb9abab957cdd">email_subject</a>, self.<a class="code" href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#a91d12c0141a1778d94d63e63afc87d01">email_body</a>) </div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;        <span class="keywordflow">except</span> Exception <span class="keyword">as</span> inst:</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;            self.<a class="code" href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#a75a43889d4b8c9c504267ec21e4a585d">formatted_log</a>(<span class="stringliteral">&#39;w&#39;</span>, <span class="stringliteral">&quot;Cannot upload file: &quot;</span> + task.filename)</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;            self.<a class="code" href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#a75a43889d4b8c9c504267ec21e4a585d">formatted_log</a>(<span class="stringliteral">&#39;w&#39;</span>, str(type(inst)) + <span class="stringliteral">&#39; &#39;</span> + str(inst))</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;            <span class="comment"># Checks, if the config values for sending an email are available.</span></div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;            <span class="keywordflow">if</span> <span class="keywordflow">not</span> RosNodeBase._recommended_missing:</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;                mail_subject = <span class="stringliteral">&quot;Upload error&quot;</span></div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;                mail_body = <span class="stringliteral">&quot;Dear user,&lt;br /&gt;{0} topic (value: {2}) triggered a new notification for you.&lt;br /&gt;\</span></div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;<span class="stringliteral">                        We are sorry, but BlackBox can not connect to the configured FTP and can not upload the file: {1}&lt;br /&gt;\</span></div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;<span class="stringliteral">                        Best regards,&lt;br /&gt;Black Box&quot;</span></div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;                <span class="comment">#notify the user with email</span></div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;                self.<a class="code" href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#a3242328c8d8a617c39b074cf3eecc8c6">send_mail</a>(task.filename, task.topic, task.value, mail_subject, mail_body) <span class="comment">#notify the user with email</span></div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    <span class="comment">## Upload Task class</span></div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    <span class="comment">#</span></div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    <span class="comment"># Contains information about an upload task, as topic, value, filename</span></div><div class="line"><a name="l00190"></a><span class="lineno"><a class="line" href="classsrc_1_1cloud__uploader_1_1CloudUploader_1_1UploadTask.html">  190</a></span>&#160;    <span class="keyword">class </span><a class="code" href="classsrc_1_1cloud__uploader_1_1CloudUploader_1_1UploadTask.html">UploadTask</a>(object):</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;        <span class="comment">## Initializes the UploadTask object</span></div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;        <span class="comment"># @param topic The topic that caused the upload</span></div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;        <span class="comment"># @param value The value of the topic</span></div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;        <span class="comment"># @param filename The name of the file to be uploaded</span></div><div class="line"><a name="l00195"></a><span class="lineno"><a class="line" href="classsrc_1_1cloud__uploader_1_1CloudUploader_1_1UploadTask.html#a1970e5cefdcc4fc0f2bbe1faa399683c">  195</a></span>&#160;        <span class="keyword">def </span><a class="code" href="classsrc_1_1cloud__uploader_1_1CloudUploader_1_1UploadTask.html#a1970e5cefdcc4fc0f2bbe1faa399683c">__init__</a>(self, topic, value, filename):</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;            <span class="comment">## The topic that caused the upload</span></div><div class="line"><a name="l00197"></a><span class="lineno"><a class="line" href="classsrc_1_1cloud__uploader_1_1CloudUploader_1_1UploadTask.html#ae7fb62f1c5b1e34ee2817e015b786e33">  197</a></span>&#160;            self.<a class="code" href="classsrc_1_1cloud__uploader_1_1CloudUploader_1_1UploadTask.html#ae7fb62f1c5b1e34ee2817e015b786e33">topic</a> = topic</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;            <span class="comment">## The value of the topic</span></div><div class="line"><a name="l00199"></a><span class="lineno"><a class="line" href="classsrc_1_1cloud__uploader_1_1CloudUploader_1_1UploadTask.html#af39e9cfaeec373b61c0a91cb049c39fe">  199</a></span>&#160;            self.<a class="code" href="classsrc_1_1cloud__uploader_1_1CloudUploader_1_1UploadTask.html#af39e9cfaeec373b61c0a91cb049c39fe">value</a> = value</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;            <span class="comment">## The name of the file to be uploaded</span></div><div class="line"><a name="l00201"></a><span class="lineno"><a class="line" href="classsrc_1_1cloud__uploader_1_1CloudUploader_1_1UploadTask.html#a01c44d5cbf4a70175e668ba23b6a5134">  201</a></span>&#160;            self.<a class="code" href="classsrc_1_1cloud__uploader_1_1CloudUploader_1_1UploadTask.html#a01c44d5cbf4a70175e668ba23b6a5134">filename</a> = filename</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    <span class="comment">## Sets the current task</span></div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    <span class="comment"># @param task The new value of the property</span></div><div class="line"><a name="l00205"></a><span class="lineno"><a class="line" href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#a2d4880d94107f9c170f1ae377c48758a">  205</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#a2d4880d94107f9c170f1ae377c48758a">set_current_task</a>(self, task):</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;        self.<a class="code" href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#a8c0ce240525b68bdbcbefb94b52c7716">currentTask</a> = task</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    <span class="comment">## Worker method for the uploader thread</span></div><div class="line"><a name="l00209"></a><span class="lineno"><a class="line" href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#aa8779006e5937f8d11c53dddebff5a48">  209</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#aa8779006e5937f8d11c53dddebff5a48">upload_worker</a>(self):</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;        <span class="comment"># run until the node is shut down </span></div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;        <span class="keywordflow">while</span> <span class="keywordflow">not</span> rospy.is_shutdown():</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;            <span class="comment"># set the currentTask to None, to have no completed task until </span></div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;            <span class="comment"># the thread is blocked by waiting for the new task to come</span></div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;            self.<a class="code" href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#a2d4880d94107f9c170f1ae377c48758a">set_current_task</a>(<span class="keywordtype">None</span>)</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;            <span class="comment">#get the first item in the queue - block if there is none</span></div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;            <span class="keywordflow">try</span>:</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;                self.<a class="code" href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#a2d4880d94107f9c170f1ae377c48758a">set_current_task</a>(self.queue.get(<span class="keyword">True</span>, 1))</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;            <span class="keywordflow">except</span> Exception <span class="keyword">as</span> ex:</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;                <span class="keywordflow">continue</span></div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;            <span class="comment">#upload to the ftp and notify the users</span></div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;            self.<a class="code" href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#a4f8cbbdde6c6c65526ccb3d7b5e15197">upload_and_notify</a>(self.<a class="code" href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#a8c0ce240525b68bdbcbefb94b52c7716">currentTask</a>)</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    <span class="comment">## Callback function for the manual upload service</span></div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    <span class="comment">#</span></div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    <span class="comment"># The consumption of the queue is running on another thread, this function only adds to the queue</span></div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    <span class="comment"># @param data The data of the service call</span></div><div class="line"><a name="l00228"></a><span class="lineno"><a class="line" href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#a5c66a0f56f327750101ff803519fefa5">  228</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#a5c66a0f56f327750101ff803519fefa5">upload_callback</a>(self, data):</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;        <span class="keywordflow">try</span>:</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;            <span class="comment">#add new task to the queue</span></div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;            t = <a class="code" href="classsrc_1_1cloud__uploader_1_1CloudUploader_1_1UploadTask.html">CloudUploader.UploadTask</a>(data.topic, data.value, data.filename)</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;            self.queue.put(t)</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;            self.<a class="code" href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#a75a43889d4b8c9c504267ec21e4a585d">formatted_log</a>(<span class="stringliteral">&#39;i&#39;</span>, <span class="stringliteral">&#39;New task added to the queue: &#39;</span> + str(t))</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;            <span class="comment">#self.formatted_log(&#39;w&#39;, &#39;Current queue length: &#39; + str(len(self.queue.queue) + (1 if self.currentTask is not None else 0)))</span></div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;        <span class="keywordflow">except</span> Exception <span class="keyword">as</span> inst:</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;            self.<a class="code" href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#a75a43889d4b8c9c504267ec21e4a585d">formatted_log</a>(<span class="stringliteral">&#39;w&#39;</span>, str(type(inst)) + <span class="stringliteral">&#39; &#39;</span> + str(inst))</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;        <span class="keywordflow">return</span> UploadResponse()</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    <span class="comment">## Callback function for the load service</span></div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    <span class="comment">#</span></div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    <span class="comment"># Load a selected file from the cloud to the local archive</span></div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    <span class="comment"># @param data The data of the service call</span></div><div class="line"><a name="l00246"></a><span class="lineno"><a class="line" href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#a5003ec94f1e601b15cec27971731b5d0">  246</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#a5003ec94f1e601b15cec27971731b5d0">load_callback</a>(self, data):</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;        <span class="keywordflow">try</span>:</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;            <span class="comment"># create an ftp session</span></div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;            session = ftplib.FTP(self.<a class="code" href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#acf4eeda64b4446e8ba832701460b7546">ftp_host</a>, self.<a class="code" href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#af9c85c8546a43561734e2d42a04261b9">ftp_username</a>, str(self.<a class="code" href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#a7710c2898f7724e6da538a14f08d5bb0">ftp_password</a>))</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;            <span class="comment"># create the local file name</span></div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;            local_filename = <span class="stringliteral">&#39;{0}{1}&#39;</span>.format(self.<a class="code" href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#a7947d11cf6ec52dcf2dd3d0bfa8b8a4a">archive_path</a>, <span class="stringliteral">&quot;black_box_import.zip&quot;</span>)</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;            <span class="comment"># retrieve the file</span></div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;            session.retrbinary(<span class="stringliteral">&quot;RETR {0}&quot;</span>.format(data.filename), open(local_filename,<span class="stringliteral">&#39;wb&#39;</span>).write) </div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;            <span class="comment"># end the ftp session</span></div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;            session.quit()</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;        <span class="keywordflow">except</span> Exception <span class="keyword">as</span> inst:</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;            self.<a class="code" href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#a75a43889d4b8c9c504267ec21e4a585d">formatted_log</a>(<span class="stringliteral">&#39;w&#39;</span>, str(type(inst)) + <span class="stringliteral">&#39; &#39;</span> + str(inst))</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;        <span class="keywordflow">return</span> UploadResponse()</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    <span class="comment">## Working method of the status_pub thread</span></div><div class="line"><a name="l00263"></a><span class="lineno"><a class="line" href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#a882f516fd4293b14f37bc6f862cf16bd">  263</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#a882f516fd4293b14f37bc6f862cf16bd">status_pub_worker</a>(self):</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;        <span class="comment"># run until the node is shut down</span></div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;        <span class="keywordflow">while</span> <span class="keywordflow">not</span> rospy.is_shutdown():</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;            <span class="comment"># every second a list of upload statuses are published</span></div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;            usl = UploadStatusList()</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;            <span class="comment"># convert the queue to a list, so we can read it without consuming it</span></div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;            ql = list(self.queue.queue)</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;            <span class="comment"># if the current task is not None, add it to the list</span></div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;            <span class="comment"># this is needed, because the current task is not part of the queue anymore</span></div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;            <span class="keywordflow">if</span> (self.<a class="code" href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#a8c0ce240525b68bdbcbefb94b52c7716">currentTask</a> <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>):</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;                ql.append(self.<a class="code" href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#a8c0ce240525b68bdbcbefb94b52c7716">currentTask</a>)</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;            <span class="comment"># assemble the list</span></div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;            <span class="keywordflow">for</span> i <span class="keywordflow">in</span> ql:</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;                us = UploadStatus()</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;                us.uploading = i == self.<a class="code" href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#a8c0ce240525b68bdbcbefb94b52c7716">currentTask</a></div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;                us.error = <span class="stringliteral">&quot;&quot;</span></div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;                us.file_name = i.filename</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;                usl.statusList.append(us)</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;            <span class="comment"># publish the list</span></div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;            self.status_publisher.publish(usl)</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;            <span class="comment">#wait 1s before starting again</span></div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;            time.sleep(1)</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    <span class="comment">## Starts the node activities</span></div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;    <span class="comment">#</span></div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    <span class="comment"># Advertises services and topics, starts the threads.</span></div><div class="line"><a name="l00291"></a><span class="lineno"><a class="line" href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#ae9324549537e8b51594104fa598fc893">  291</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#ae9324549537e8b51594104fa598fc893">start</a>(self):</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;        <span class="keywordflow">try</span>:</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;            <span class="comment"># Loads the config values from rosparam</span></div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;            self.<a class="code" href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#a06c9310aef0ce0915b402d62d4e6c047">load_config</a>()</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;            <span class="comment"># advertise upload service</span></div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;            rospy.Service(RosNodeBase._ns(self, <span class="stringliteral">&#39;upload&#39;</span>), Upload, self.<a class="code" href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#a5c66a0f56f327750101ff803519fefa5">upload_callback</a>)</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;            <span class="comment"># advertise load service</span></div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;            rospy.Service(RosNodeBase._ns(self, <span class="stringliteral">&#39;load&#39;</span>), Upload, self.<a class="code" href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#a5003ec94f1e601b15cec27971731b5d0">load_callback</a>)</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;            <span class="comment">## The status publisher object</span></div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;            <span class="comment"># advertise the status topic</span></div><div class="line"><a name="l00302"></a><span class="lineno"><a class="line" href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#a5f5a1fc2a0b393acf352cdd0d35b4a76">  302</a></span>&#160;            self.<a class="code" href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#a5f5a1fc2a0b393acf352cdd0d35b4a76">status_publisher</a> = rospy.Publisher(RosNodeBase._ns(self, <span class="stringliteral">&#39;status&#39;</span>), UploadStatusList, queue_size=1)</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;            <span class="comment">## status update thread</span></div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;            status_thread = Thread(target = self.<a class="code" href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#a882f516fd4293b14f37bc6f862cf16bd">status_pub_worker</a>, args=())</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;            status_thread.start()</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;            <span class="comment">## uploader thread</span></div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;            upload_thread = Thread(target = self.<a class="code" href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#aa8779006e5937f8d11c53dddebff5a48">upload_worker</a>, args=())</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;            upload_thread.start()</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;            </div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;            rospy.spin()</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;        <span class="keywordflow">except</span> Exception <span class="keyword">as</span> inst:</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;            self.<a class="code" href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#a75a43889d4b8c9c504267ec21e4a585d">formatted_log</a>(<span class="stringliteral">&#39;e&#39;</span>, str(type(inst)) + <span class="stringliteral">&#39; &#39;</span> + str(inst))</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;<span class="comment">## Main function</span></div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;<span class="keywordflow">if</span> __name__ == <span class="stringliteral">&#39;__main__&#39;</span>:</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;    <span class="keywordflow">try</span>:</div><div class="line"><a name="l00321"></a><span class="lineno"><a class="line" href="namespacesrc_1_1cloud__uploader.html#a66627afd306c7075bff95f2d46e305c5">  321</a></span>&#160;        rospy.init_node(<span class="stringliteral">&#39;cloud_uploader&#39;</span>, anonymous=<span class="keyword">True</span>, log_level=rospy.INFO)</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;        </div><div class="line"><a name="l00323"></a><span class="lineno"><a class="line" href="namespacesrc_1_1cloud__uploader.html#abb9643d7d9030854f625788a193403a7">  323</a></span>&#160;        cu = <a class="code" href="classsrc_1_1cloud__uploader_1_1CloudUploader.html">CloudUploader</a>()</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;        cu.start()</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;    <span class="keywordflow">except</span> Exception <span class="keyword">as</span> inst:</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;        rospy.logerr(<span class="stringliteral">&#39;[BBU] &#39;</span> + str(type(inst)) + <span class="stringliteral">&#39; &#39;</span> + str(inst))</div><div class="ttc" id="classsrc_1_1cloud__uploader_1_1CloudUploader_html_a7710c2898f7724e6da538a14f08d5bb0"><div class="ttname"><a href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#a7710c2898f7724e6da538a14f08d5bb0">src.cloud_uploader.CloudUploader.ftp_password</a></div><div class="ttdeci">ftp_password</div><div class="ttdoc">The password of the FTP. </div><div class="ttdef"><b>Definition:</b> <a href="cloud__uploader_8py_source.html#l00084">cloud_uploader.py:84</a></div></div>
<div class="ttc" id="classsrc_1_1cloud__uploader_1_1CloudUploader_1_1UploadTask_html"><div class="ttname"><a href="classsrc_1_1cloud__uploader_1_1CloudUploader_1_1UploadTask.html">src.cloud_uploader.CloudUploader.UploadTask</a></div><div class="ttdoc">Upload Task class. </div><div class="ttdef"><b>Definition:</b> <a href="cloud__uploader_8py_source.html#l00190">cloud_uploader.py:190</a></div></div>
<div class="ttc" id="classsrc_1_1cloud__uploader_1_1CloudUploader_1_1UploadTask_html_a01c44d5cbf4a70175e668ba23b6a5134"><div class="ttname"><a href="classsrc_1_1cloud__uploader_1_1CloudUploader_1_1UploadTask.html#a01c44d5cbf4a70175e668ba23b6a5134">src.cloud_uploader.CloudUploader.UploadTask.filename</a></div><div class="ttdeci">filename</div><div class="ttdoc">The name of the file to be uploaded. </div><div class="ttdef"><b>Definition:</b> <a href="cloud__uploader_8py_source.html#l00201">cloud_uploader.py:201</a></div></div>
<div class="ttc" id="classsrc_1_1cloud__uploader_1_1CloudUploader_html_a8a6cffd7993ebc45d34fd27a06e5a2ee"><div class="ttname"><a href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#a8a6cffd7993ebc45d34fd27a06e5a2ee">src.cloud_uploader.CloudUploader.smtp_connection_mode</a></div><div class="ttdeci">smtp_connection_mode</div><div class="ttdoc">The connection mode of the SMTP server. </div><div class="ttdef"><b>Definition:</b> <a href="cloud__uploader_8py_source.html#l00096">cloud_uploader.py:96</a></div></div>
<div class="ttc" id="classsrc_1_1cloud__uploader_1_1CloudUploader_html_ae21dd62eb0c05e385e497e6d4e16fe22"><div class="ttname"><a href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#ae21dd62eb0c05e385e497e6d4e16fe22">src.cloud_uploader.CloudUploader.node_id</a></div><div class="ttdeci">node_id</div><div class="ttdoc">The id of the node, used in logs. </div><div class="ttdef"><b>Definition:</b> <a href="cloud__uploader_8py_source.html#l00058">cloud_uploader.py:58</a></div></div>
<div class="ttc" id="classsrc_1_1cloud__uploader_1_1CloudUploader_html_a2cdbf6b5f52ec0aa4485f93af144a9c6"><div class="ttname"><a href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#a2cdbf6b5f52ec0aa4485f93af144a9c6">src.cloud_uploader.CloudUploader.smtp_host</a></div><div class="ttdeci">smtp_host</div><div class="ttdoc">The host address of the SMTP server. </div><div class="ttdef"><b>Definition:</b> <a href="cloud__uploader_8py_source.html#l00090">cloud_uploader.py:90</a></div></div>
<div class="ttc" id="classsrc_1_1cloud__uploader_1_1CloudUploader_1_1UploadTask_html_af39e9cfaeec373b61c0a91cb049c39fe"><div class="ttname"><a href="classsrc_1_1cloud__uploader_1_1CloudUploader_1_1UploadTask.html#af39e9cfaeec373b61c0a91cb049c39fe">src.cloud_uploader.CloudUploader.UploadTask.value</a></div><div class="ttdeci">value</div><div class="ttdoc">The value of the topic. </div><div class="ttdef"><b>Definition:</b> <a href="cloud__uploader_8py_source.html#l00199">cloud_uploader.py:199</a></div></div>
<div class="ttc" id="classsrc_1_1cloud__uploader_1_1CloudUploader_1_1UploadTask_html_ae7fb62f1c5b1e34ee2817e015b786e33"><div class="ttname"><a href="classsrc_1_1cloud__uploader_1_1CloudUploader_1_1UploadTask.html#ae7fb62f1c5b1e34ee2817e015b786e33">src.cloud_uploader.CloudUploader.UploadTask.topic</a></div><div class="ttdeci">topic</div><div class="ttdoc">The topic that caused the upload. </div><div class="ttdef"><b>Definition:</b> <a href="cloud__uploader_8py_source.html#l00197">cloud_uploader.py:197</a></div></div>
<div class="ttc" id="classsrc_1_1cloud__uploader_1_1CloudUploader_html_a8c0ce240525b68bdbcbefb94b52c7716"><div class="ttname"><a href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#a8c0ce240525b68bdbcbefb94b52c7716">src.cloud_uploader.CloudUploader.currentTask</a></div><div class="ttdeci">currentTask</div><div class="ttdoc">The current task, already removed from the queue. </div><div class="ttdef"><b>Definition:</b> <a href="cloud__uploader_8py_source.html#l00062">cloud_uploader.py:62</a></div></div>
<div class="ttc" id="classsrc_1_1cloud__uploader_1_1CloudUploader_html_a84d3c140aaad17a4555fb79807769b4e"><div class="ttname"><a href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#a84d3c140aaad17a4555fb79807769b4e">src.cloud_uploader.CloudUploader.__init__</a></div><div class="ttdeci">def __init__(self)</div><div class="ttdoc">Initalizes the class. </div><div class="ttdef"><b>Definition:</b> <a href="cloud__uploader_8py_source.html#l00056">cloud_uploader.py:56</a></div></div>
<div class="ttc" id="classsrc_1_1cloud__uploader_1_1CloudUploader_html_a7947d11cf6ec52dcf2dd3d0bfa8b8a4a"><div class="ttname"><a href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#a7947d11cf6ec52dcf2dd3d0bfa8b8a4a">src.cloud_uploader.CloudUploader.archive_path</a></div><div class="ttdeci">archive_path</div><div class="ttdoc">The path where the archive files are stored. </div><div class="ttdef"><b>Definition:</b> <a href="cloud__uploader_8py_source.html#l00101">cloud_uploader.py:101</a></div></div>
<div class="ttc" id="classsrc_1_1cloud__uploader_1_1CloudUploader_html_a4f8db825ceb6b2e2b15cefa896180ff3"><div class="ttname"><a href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#a4f8db825ceb6b2e2b15cefa896180ff3">src.cloud_uploader.CloudUploader.smtp_port</a></div><div class="ttdeci">smtp_port</div><div class="ttdoc">The port of the SMTP server. </div><div class="ttdef"><b>Definition:</b> <a href="cloud__uploader_8py_source.html#l00098">cloud_uploader.py:98</a></div></div>
<div class="ttc" id="classsrc_1_1cloud__uploader_1_1CloudUploader_html_a5003ec94f1e601b15cec27971731b5d0"><div class="ttname"><a href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#a5003ec94f1e601b15cec27971731b5d0">src.cloud_uploader.CloudUploader.load_callback</a></div><div class="ttdeci">def load_callback(self, data)</div><div class="ttdoc">Callback function for the load service. </div><div class="ttdef"><b>Definition:</b> <a href="cloud__uploader_8py_source.html#l00246">cloud_uploader.py:246</a></div></div>
<div class="ttc" id="classsrc_1_1cloud__uploader_1_1CloudUploader_html_a3242328c8d8a617c39b074cf3eecc8c6"><div class="ttname"><a href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#a3242328c8d8a617c39b074cf3eecc8c6">src.cloud_uploader.CloudUploader.send_mail</a></div><div class="ttdeci">def send_mail(self, archivename, topic, value, subject, body)</div><div class="ttdoc">Sends an email. </div><div class="ttdef"><b>Definition:</b> <a href="cloud__uploader_8py_source.html#l00123">cloud_uploader.py:123</a></div></div>
<div class="ttc" id="classsrc_1_1cloud__uploader_1_1CloudUploader_html_ab0204c1b5902f8228dc6c3fe5b49cf1d"><div class="ttname"><a href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#ab0204c1b5902f8228dc6c3fe5b49cf1d">src.cloud_uploader.CloudUploader.queue</a></div><div class="ttdeci">queue</div><div class="ttdoc">The upload queue. </div><div class="ttdef"><b>Definition:</b> <a href="cloud__uploader_8py_source.html#l00060">cloud_uploader.py:60</a></div></div>
<div class="ttc" id="classsrc_1_1cloud__uploader_1_1CloudUploader_html_aa8779006e5937f8d11c53dddebff5a48"><div class="ttname"><a href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#aa8779006e5937f8d11c53dddebff5a48">src.cloud_uploader.CloudUploader.upload_worker</a></div><div class="ttdeci">def upload_worker(self)</div><div class="ttdoc">Worker method for the uploader thread. </div><div class="ttdef"><b>Definition:</b> <a href="cloud__uploader_8py_source.html#l00209">cloud_uploader.py:209</a></div></div>
<div class="ttc" id="classsrc_1_1cloud__uploader_1_1CloudUploader_html_a06c9310aef0ce0915b402d62d4e6c047"><div class="ttname"><a href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#a06c9310aef0ce0915b402d62d4e6c047">src.cloud_uploader.CloudUploader.load_config</a></div><div class="ttdeci">def load_config(self)</div><div class="ttdoc">Loads and checks the config values from rosparam. </div><div class="ttdef"><b>Definition:</b> <a href="cloud__uploader_8py_source.html#l00075">cloud_uploader.py:75</a></div></div>
<div class="ttc" id="classsrc_1_1cloud__uploader_1_1CloudUploader_html_acf4eeda64b4446e8ba832701460b7546"><div class="ttname"><a href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#acf4eeda64b4446e8ba832701460b7546">src.cloud_uploader.CloudUploader.ftp_host</a></div><div class="ttdeci">ftp_host</div><div class="ttdoc">The host address of the FTP. </div><div class="ttdef"><b>Definition:</b> <a href="cloud__uploader_8py_source.html#l00082">cloud_uploader.py:82</a></div></div>
<div class="ttc" id="classsrc_1_1cloud__uploader_1_1CloudUploader_html_a2d4880d94107f9c170f1ae377c48758a"><div class="ttname"><a href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#a2d4880d94107f9c170f1ae377c48758a">src.cloud_uploader.CloudUploader.set_current_task</a></div><div class="ttdeci">def set_current_task(self, task)</div><div class="ttdoc">Sets the current task. </div><div class="ttdef"><b>Definition:</b> <a href="cloud__uploader_8py_source.html#l00205">cloud_uploader.py:205</a></div></div>
<div class="ttc" id="classsrc_1_1cloud__uploader_1_1CloudUploader_html_a4f8cbbdde6c6c65526ccb3d7b5e15197"><div class="ttname"><a href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#a4f8cbbdde6c6c65526ccb3d7b5e15197">src.cloud_uploader.CloudUploader.upload_and_notify</a></div><div class="ttdeci">def upload_and_notify(self, task)</div><div class="ttdoc">Uploads a file to an FTP and sends email containing the details. </div><div class="ttdef"><b>Definition:</b> <a href="cloud__uploader_8py_source.html#l00150">cloud_uploader.py:150</a></div></div>
<div class="ttc" id="classsrc_1_1cloud__uploader_1_1CloudUploader_html_a882f516fd4293b14f37bc6f862cf16bd"><div class="ttname"><a href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#a882f516fd4293b14f37bc6f862cf16bd">src.cloud_uploader.CloudUploader.status_pub_worker</a></div><div class="ttdeci">def status_pub_worker(self)</div><div class="ttdoc">Working method of the status_pub thread. </div><div class="ttdef"><b>Definition:</b> <a href="cloud__uploader_8py_source.html#l00263">cloud_uploader.py:263</a></div></div>
<div class="ttc" id="classsrc_1_1cloud__uploader_1_1CloudUploader_html_a5f5a1fc2a0b393acf352cdd0d35b4a76"><div class="ttname"><a href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#a5f5a1fc2a0b393acf352cdd0d35b4a76">src.cloud_uploader.CloudUploader.status_publisher</a></div><div class="ttdeci">status_publisher</div><div class="ttdoc">The status publisher object advertise the status topic. </div><div class="ttdef"><b>Definition:</b> <a href="cloud__uploader_8py_source.html#l00302">cloud_uploader.py:302</a></div></div>
<div class="ttc" id="classsrc_1_1cloud__uploader_1_1CloudUploader_html_a26e3194af13c00728bdeb9abab957cdd"><div class="ttname"><a href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#a26e3194af13c00728bdeb9abab957cdd">src.cloud_uploader.CloudUploader.email_subject</a></div><div class="ttdeci">email_subject</div><div class="ttdoc">The subject of the emails to be sent. </div><div class="ttdef"><b>Definition:</b> <a href="cloud__uploader_8py_source.html#l00109">cloud_uploader.py:109</a></div></div>
<div class="ttc" id="classsrc_1_1cloud__uploader_1_1CloudUploader_html_ae9324549537e8b51594104fa598fc893"><div class="ttname"><a href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#ae9324549537e8b51594104fa598fc893">src.cloud_uploader.CloudUploader.start</a></div><div class="ttdeci">def start(self)</div><div class="ttdoc">Starts the node activities. </div><div class="ttdef"><b>Definition:</b> <a href="cloud__uploader_8py_source.html#l00291">cloud_uploader.py:291</a></div></div>
<div class="ttc" id="classsrc_1_1cloud__uploader_1_1CloudUploader_html_af9c85c8546a43561734e2d42a04261b9"><div class="ttname"><a href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#af9c85c8546a43561734e2d42a04261b9">src.cloud_uploader.CloudUploader.ftp_username</a></div><div class="ttdeci">ftp_username</div><div class="ttdoc">The username of the FTP. </div><div class="ttdef"><b>Definition:</b> <a href="cloud__uploader_8py_source.html#l00086">cloud_uploader.py:86</a></div></div>
<div class="ttc" id="classsrc_1_1cloud__uploader_1_1CloudUploader_html"><div class="ttname"><a href="classsrc_1_1cloud__uploader_1_1CloudUploader.html">src.cloud_uploader.CloudUploader</a></div><div class="ttdoc">Uploads files to an FTP server. </div><div class="ttdef"><b>Definition:</b> <a href="cloud__uploader_8py_source.html#l00053">cloud_uploader.py:53</a></div></div>
<div class="ttc" id="classsrc_1_1cloud__uploader_1_1CloudUploader_1_1UploadTask_html_a1970e5cefdcc4fc0f2bbe1faa399683c"><div class="ttname"><a href="classsrc_1_1cloud__uploader_1_1CloudUploader_1_1UploadTask.html#a1970e5cefdcc4fc0f2bbe1faa399683c">src.cloud_uploader.CloudUploader.UploadTask.__init__</a></div><div class="ttdeci">def __init__(self, topic, value, filename)</div><div class="ttdoc">Initializes the UploadTask object. </div><div class="ttdef"><b>Definition:</b> <a href="cloud__uploader_8py_source.html#l00195">cloud_uploader.py:195</a></div></div>
<div class="ttc" id="classsrc_1_1cloud__uploader_1_1CloudUploader_html_aa825f2ae2c1ad79c43902d40f5c99844"><div class="ttname"><a href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#aa825f2ae2c1ad79c43902d40f5c99844">src.cloud_uploader.CloudUploader.smtp_password</a></div><div class="ttdeci">smtp_password</div><div class="ttdoc">The password of the SMTP server. </div><div class="ttdef"><b>Definition:</b> <a href="cloud__uploader_8py_source.html#l00094">cloud_uploader.py:94</a></div></div>
<div class="ttc" id="classsrc_1_1cloud__uploader_1_1CloudUploader_html_a5c66a0f56f327750101ff803519fefa5"><div class="ttname"><a href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#a5c66a0f56f327750101ff803519fefa5">src.cloud_uploader.CloudUploader.upload_callback</a></div><div class="ttdeci">def upload_callback(self, data)</div><div class="ttdoc">Callback function for the manual upload service. </div><div class="ttdef"><b>Definition:</b> <a href="cloud__uploader_8py_source.html#l00228">cloud_uploader.py:228</a></div></div>
<div class="ttc" id="classsrc_1_1cloud__uploader_1_1CloudUploader_html_a91d12c0141a1778d94d63e63afc87d01"><div class="ttname"><a href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#a91d12c0141a1778d94d63e63afc87d01">src.cloud_uploader.CloudUploader.email_body</a></div><div class="ttdeci">email_body</div><div class="ttdoc">The body of the emails to be sent. </div><div class="ttdef"><b>Definition:</b> <a href="cloud__uploader_8py_source.html#l00107">cloud_uploader.py:107</a></div></div>
<div class="ttc" id="classsrc_1_1cloud__uploader_1_1CloudUploader_html_a5e588db2a8b38584a6c5e6c3713daa8b"><div class="ttname"><a href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#a5e588db2a8b38584a6c5e6c3713daa8b">src.cloud_uploader.CloudUploader.email_toaddress</a></div><div class="ttdeci">email_toaddress</div><div class="ttdoc">The address where the emails should be sent. </div><div class="ttdef"><b>Definition:</b> <a href="cloud__uploader_8py_source.html#l00105">cloud_uploader.py:105</a></div></div>
<div class="ttc" id="classsrc_1_1cloud__uploader_1_1CloudUploader_html_a75a43889d4b8c9c504267ec21e4a585d"><div class="ttname"><a href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#a75a43889d4b8c9c504267ec21e4a585d">src.cloud_uploader.CloudUploader.formatted_log</a></div><div class="ttdeci">def formatted_log(self, type, msg)</div><div class="ttdoc">Formats a log message. </div><div class="ttdef"><b>Definition:</b> <a href="cloud__uploader_8py_source.html#l00067">cloud_uploader.py:67</a></div></div>
<div class="ttc" id="classsrc_1_1cloud__uploader_1_1CloudUploader_html_a42453bf465115f3c6acd94c8c323991c"><div class="ttname"><a href="classsrc_1_1cloud__uploader_1_1CloudUploader.html#a42453bf465115f3c6acd94c8c323991c">src.cloud_uploader.CloudUploader.smtp_username</a></div><div class="ttdeci">smtp_username</div><div class="ttdoc">The username of the SMTP server. </div><div class="ttdef"><b>Definition:</b> <a href="cloud__uploader_8py_source.html#l00092">cloud_uploader.py:92</a></div></div>
</div><!-- fragment --></div><!-- contents -->

<br clear="all" />
<hr size="1"><div style="align: right;">
<a href="http://wiki.ros.org/main">main</a><br />
Author(s): </br />
<small>autogenerated on Tue Dec 3 2019 16:02:36</small>
</div>
</body>
</html>
