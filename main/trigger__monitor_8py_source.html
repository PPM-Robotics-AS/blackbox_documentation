<html><head><meta http-equiv="Content-Type" content="text/html;charset=utf-8">
<title>main: trigger_monitor.py Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
<script type="text/javascript" src="jquery.js"></script>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.8.11 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
    </ul>
  </div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">trigger_monitor.py</div>  </div>
</div><!--header-->
<div class="contents">
<a href="trigger__monitor_8py.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno"><a class="line" href="namespacesrc_1_1trigger__monitor.html">    1</a></span>&#160;<span class="comment">#!/usr/bin/python</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="stringliteral">BLACKBOX</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="stringliteral">Version 0.0.1, March 2019</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="stringliteral">http://rosin-project.eu/ftp/blackbox</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="stringliteral">Copyright (c) 2019 PPM Robotics AS</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="stringliteral">This library is part of BLACKBOX project,</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="stringliteral">the Focused Technical Project BLACKBOX - an automated trigger-based </span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="stringliteral">reporting, data recording and playback unit for ROS</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="stringliteral">is co-financed by the EU project ROSIN (www.rosin-project.eu)</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="stringliteral">and ROS-Industrial initiative (www.rosindustrial.eu).</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="stringliteral">Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="stringliteral">you may not use this file except in compliance with the License.</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="stringliteral">You may obtain a copy of the License at</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="stringliteral">    http://www.apache.org/licenses/LICENSE-2.0</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="stringliteral">Unless required by applicable law or agreed to in writing, software</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="stringliteral">distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="stringliteral">WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="stringliteral">See the License for the specific language governing permissions and</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="stringliteral">limitations under the License.</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="keyword">import</span> rospy</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="keyword">import</span> roslib</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="keyword">import</span> rostopic</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="keyword">import</span> urllib2</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="keyword">import</span> argparse</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="keyword">from</span> ast <span class="keyword">import</span> literal_eval</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="keyword">import</span> re</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="keyword">import</span> ftplib</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="keyword">import</span> time</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="keyword">import</span> smtplib</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="keyword">import</span> datetime</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="keyword">import</span> Queue</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="keyword">import</span> shutil</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="keyword">import</span> os</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="keyword">import</span> ujson</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="keyword">from</span> os.path <span class="keyword">import</span> expanduser</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="comment">#from deepdiff import DeepDiff</span></div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="keyword">from</span> blackbox_main.msg <span class="keyword">import</span> Trigger</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="keyword">from</span> ros_node_base <span class="keyword">import</span> RosNodeBase</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="keyword">from</span> threading <span class="keyword">import</span> Thread    </div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="keyword">from</span> blackbox_control.srv <span class="keyword">import</span> GetAvailableRange, Export</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="keyword">from</span> blackbox_main.srv <span class="keyword">import</span> Upload, UploadRequest</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="keyword">from</span> std_msgs.msg <span class="keyword">import</span> Header</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="comment">## Handles events and triggers exports based on set conditions</span></div><div class="line"><a name="l00055"></a><span class="lineno"><a class="line" href="classsrc_1_1trigger__monitor_1_1TriggerMonitor.html">   55</a></span>&#160;<span class="keyword">class </span><a class="code" href="classsrc_1_1trigger__monitor_1_1TriggerMonitor.html">TriggerMonitor</a>(RosNodeBase):</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;</div><div class="line"><a name="l00057"></a><span class="lineno"><a class="line" href="classsrc_1_1trigger__monitor_1_1TriggerMonitor.html#a7a0fc158ec32eac325de693a7fce8a07">   57</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classsrc_1_1trigger__monitor_1_1TriggerMonitor.html#a7a0fc158ec32eac325de693a7fce8a07">__init__</a>(self):</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;        <span class="comment">## The id of the node, used in logs</span></div><div class="line"><a name="l00059"></a><span class="lineno"><a class="line" href="classsrc_1_1trigger__monitor_1_1TriggerMonitor.html#a6bb1015a2afd175d93eb44c6a1a3b05c">   59</a></span>&#160;        self.<a class="code" href="classsrc_1_1trigger__monitor_1_1TriggerMonitor.html#a6bb1015a2afd175d93eb44c6a1a3b05c">node_id</a> = <span class="stringliteral">&quot;BBTM&quot;</span></div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;        <span class="comment">## Dictionary of conditions</span></div><div class="line"><a name="l00061"></a><span class="lineno"><a class="line" href="classsrc_1_1trigger__monitor_1_1TriggerMonitor.html#a79a4335122bfccecf669bd88ca4a8903">   61</a></span>&#160;        self.<a class="code" href="classsrc_1_1trigger__monitor_1_1TriggerMonitor.html#a79a4335122bfccecf669bd88ca4a8903">conditions</a> = <span class="keywordtype">None</span></div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;        <span class="comment">## True, if an export operation is ongoing. This will prevent other exports to start</span></div><div class="line"><a name="l00063"></a><span class="lineno"><a class="line" href="classsrc_1_1trigger__monitor_1_1TriggerMonitor.html#af189f0cdfea82bf9360723807ebb8612">   63</a></span>&#160;        self.<a class="code" href="classsrc_1_1trigger__monitor_1_1TriggerMonitor.html#af189f0cdfea82bf9360723807ebb8612">exporting</a> = <span class="keyword">False</span></div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;        <span class="comment">## Previous values dictionary</span></div><div class="line"><a name="l00065"></a><span class="lineno"><a class="line" href="classsrc_1_1trigger__monitor_1_1TriggerMonitor.html#a151b385bb18add1d22722cc75f72d2ab">   65</a></span>&#160;        self.<a class="code" href="classsrc_1_1trigger__monitor_1_1TriggerMonitor.html#a151b385bb18add1d22722cc75f72d2ab">prev_values</a> = {}</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;        <span class="comment">## Previous change times dictionary</span></div><div class="line"><a name="l00067"></a><span class="lineno"><a class="line" href="classsrc_1_1trigger__monitor_1_1TriggerMonitor.html#a4024c3e42ed99ab988d9aba40269ce6c">   67</a></span>&#160;        self.<a class="code" href="classsrc_1_1trigger__monitor_1_1TriggerMonitor.html#a4024c3e42ed99ab988d9aba40269ce6c">prev_change</a> = {}</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;        </div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    <span class="comment">## Formats a log message</span></div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    <span class="comment"># @param type The type of the message. Possibilities: (&#39;e&#39;, &#39;w&#39;, &#39;i&#39;). Others are treated as errors.</span></div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    <span class="comment"># @param msg The message to be printed.</span></div><div class="line"><a name="l00073"></a><span class="lineno"><a class="line" href="classsrc_1_1trigger__monitor_1_1TriggerMonitor.html#aef60b650bc0bfbd432eadf3aa9c3ae23">   73</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classsrc_1_1trigger__monitor_1_1TriggerMonitor.html#aef60b650bc0bfbd432eadf3aa9c3ae23">formatted_log</a>(self, type, msg):</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;        RosNodeBase._formatted_log(self, type, msg, self.<a class="code" href="classsrc_1_1trigger__monitor_1_1TriggerMonitor.html#a6bb1015a2afd175d93eb44c6a1a3b05c">node_id</a>)</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    <span class="comment">## Loads and checks the config values from rosparam</span></div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    <span class="comment">#</span></div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    <span class="comment"># If recommended elements are mising, shows a warning. </span></div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    <span class="comment"># If mandatory elements are missing, shows an error end exits the program.</span></div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    <span class="comment"># Some params are none of these, they already have default values that are acceptable.</span></div><div class="line"><a name="l00081"></a><span class="lineno"><a class="line" href="classsrc_1_1trigger__monitor_1_1TriggerMonitor.html#a748846959b7547788b60fb48293636b1">   81</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classsrc_1_1trigger__monitor_1_1TriggerMonitor.html#a748846959b7547788b60fb48293636b1">load_config</a>(self):</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;        <span class="comment"># Gets a rospy param with namespace</span></div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;        <span class="keyword">def </span>gp(key, def_val):</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;            <span class="keywordflow">return</span> rospy.get_param(RosNodeBase._ns(self, key), def_val)</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;        <span class="comment">#read config</span></div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;        home = expanduser(<span class="stringliteral">&quot;~&quot;</span>)</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;        <span class="keywordflow">try</span>:</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;            js = gp(<span class="stringliteral">&quot;conditions&quot;</span>, <span class="keywordtype">None</span>)</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;            <span class="comment">#self.formatted_log(&#39;w&#39;, js)</span></div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;            self.<a class="code" href="classsrc_1_1trigger__monitor_1_1TriggerMonitor.html#a79a4335122bfccecf669bd88ca4a8903">conditions</a> = ujson.loads(js)</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;        <span class="keywordflow">except</span> Exception <span class="keyword">as</span> inst:</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;            self.<a class="code" href="classsrc_1_1trigger__monitor_1_1TriggerMonitor.html#aef60b650bc0bfbd432eadf3aa9c3ae23">formatted_log</a>(<span class="stringliteral">&#39;e&#39;</span>, str(type(inst)) + <span class="stringliteral">&#39; &#39;</span> + str(inst))</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;        <span class="comment">## If true, triggers will happen only when the value of the topic has changed</span></div><div class="line"><a name="l00097"></a><span class="lineno"><a class="line" href="classsrc_1_1trigger__monitor_1_1TriggerMonitor.html#a9005ca161e52ab93688cb46ad31db4ef">   97</a></span>&#160;        self.<a class="code" href="classsrc_1_1trigger__monitor_1_1TriggerMonitor.html#a9005ca161e52ab93688cb46ad31db4ef">on_change_only</a> = gp(<span class="stringliteral">&quot;on_change_only&quot;</span>, <span class="keyword">False</span>)</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;        <span class="comment">## The minimum time required to register a new trigger</span></div><div class="line"><a name="l00099"></a><span class="lineno"><a class="line" href="classsrc_1_1trigger__monitor_1_1TriggerMonitor.html#adba2e74b17219ce7845f123f6dc07b4c">   99</a></span>&#160;        self.<a class="code" href="classsrc_1_1trigger__monitor_1_1TriggerMonitor.html#adba2e74b17219ce7845f123f6dc07b4c">trigger_delay</a> = gp(<span class="stringliteral">&quot;trigger_delay&quot;</span>, 1000)</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;        <span class="comment">## How many seconds before the event should be exported</span></div><div class="line"><a name="l00101"></a><span class="lineno"><a class="line" href="classsrc_1_1trigger__monitor_1_1TriggerMonitor.html#aed94d467c566932243267543baa21bfc">  101</a></span>&#160;        self.<a class="code" href="classsrc_1_1trigger__monitor_1_1TriggerMonitor.html#aed94d467c566932243267543baa21bfc">bag_from</a> = int(gp(<span class="stringliteral">&quot;bag_from&quot;</span>, <span class="stringliteral">&quot;5&quot;</span>))</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;        <span class="comment">## How many seconds after the event should be exported</span></div><div class="line"><a name="l00103"></a><span class="lineno"><a class="line" href="classsrc_1_1trigger__monitor_1_1TriggerMonitor.html#aec3e3606d2ab0e22d517ae990bfc6a41">  103</a></span>&#160;        self.<a class="code" href="classsrc_1_1trigger__monitor_1_1TriggerMonitor.html#aec3e3606d2ab0e22d517ae990bfc6a41">bag_to</a> = int(gp(<span class="stringliteral">&quot;bag_to&quot;</span>, <span class="stringliteral">&quot;5&quot;</span>))</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;        <span class="comment">## The path where the bag files are stored</span></div><div class="line"><a name="l00105"></a><span class="lineno"><a class="line" href="classsrc_1_1trigger__monitor_1_1TriggerMonitor.html#aea3a65401bddc98488e90bea57dc4308">  105</a></span>&#160;        self.<a class="code" href="classsrc_1_1trigger__monitor_1_1TriggerMonitor.html#aea3a65401bddc98488e90bea57dc4308">bag_path</a> = gp(<span class="stringliteral">&quot;bag_path&quot;</span>, <span class="keywordtype">None</span>)</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;        self.<a class="code" href="classsrc_1_1trigger__monitor_1_1TriggerMonitor.html#aef60b650bc0bfbd432eadf3aa9c3ae23">formatted_log</a>(<span class="stringliteral">&#39;i&#39;</span>, <span class="stringliteral">&#39;Config loaded&#39;</span>)</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;        RosNodeBase._check_config(self, self.<a class="code" href="classsrc_1_1trigger__monitor_1_1TriggerMonitor.html#a6bb1015a2afd175d93eb44c6a1a3b05c">node_id</a>, mandatory = [<span class="stringliteral">&quot;conditions&quot;</span>, <span class="stringliteral">&quot;bag_path&quot;</span>])</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    <span class="comment">## Saves a bag file and notify the users</span></div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    <span class="comment"># @param data The published data of the topic</span></div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    <span class="comment"># @param path The path of the topic</span></div><div class="line"><a name="l00114"></a><span class="lineno"><a class="line" href="classsrc_1_1trigger__monitor_1_1TriggerMonitor.html#ac57a319967a575d82e792adb34a9d6e8">  114</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classsrc_1_1trigger__monitor_1_1TriggerMonitor.html#ac57a319967a575d82e792adb34a9d6e8">variable_changed</a>(self, data, path):</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;        <span class="comment">## the current time</span></div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;        now = datetime.datetime.now()</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;        <span class="comment">## time since the last accepted change</span></div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;        time_since = datetime.timedelta(weeks=9) <span class="keywordflow">if</span> path <span class="keywordflow">not</span> <span class="keywordflow">in</span> self.<a class="code" href="classsrc_1_1trigger__monitor_1_1TriggerMonitor.html#a4024c3e42ed99ab988d9aba40269ce6c">prev_change</a> <span class="keywordflow">else</span> now - self.<a class="code" href="classsrc_1_1trigger__monitor_1_1TriggerMonitor.html#a4024c3e42ed99ab988d9aba40269ce6c">prev_change</a>[path]</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;        <span class="comment">## check if the value of the topic has changed</span></div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;        changed = path <span class="keywordflow">not</span> <span class="keywordflow">in</span> self.<a class="code" href="classsrc_1_1trigger__monitor_1_1TriggerMonitor.html#a151b385bb18add1d22722cc75f72d2ab">prev_values</a> <span class="keywordflow">or</span> self.<a class="code" href="classsrc_1_1trigger__monitor_1_1TriggerMonitor.html#a151b385bb18add1d22722cc75f72d2ab">prev_values</a>[path] != data</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;        <span class="comment"># save the current value</span></div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;        self.<a class="code" href="classsrc_1_1trigger__monitor_1_1TriggerMonitor.html#a151b385bb18add1d22722cc75f72d2ab">prev_values</a>[path] = data</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;        <span class="comment"># if the exporting is already being done, then the current event will be part of it anyways</span></div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classsrc_1_1trigger__monitor_1_1TriggerMonitor.html#af189f0cdfea82bf9360723807ebb8612">exporting</a>:</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;            <span class="keywordflow">return</span></div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;        <span class="comment"># if the on_change_only mode is on, and there is no change, return</span></div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classsrc_1_1trigger__monitor_1_1TriggerMonitor.html#a9005ca161e52ab93688cb46ad31db4ef">on_change_only</a> <span class="keywordflow">and</span> <span class="keywordflow">not</span> changed:</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;            <span class="keywordflow">return</span></div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;        <span class="comment"># if the time since the last change is less than the minimum, return</span></div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;        <span class="keywordflow">if</span> time_since.total_seconds() * 1000 &lt; self.<a class="code" href="classsrc_1_1trigger__monitor_1_1TriggerMonitor.html#adba2e74b17219ce7845f123f6dc07b4c">trigger_delay</a>:</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;            <span class="keywordflow">return</span></div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;        <span class="comment"># save the current time</span></div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;        self.<a class="code" href="classsrc_1_1trigger__monitor_1_1TriggerMonitor.html#a4024c3e42ed99ab988d9aba40269ce6c">prev_change</a>[path] = now</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;        <span class="comment"># make the values of other topics available in the conditions</span></div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;        topics = self.<a class="code" href="classsrc_1_1trigger__monitor_1_1TriggerMonitor.html#a151b385bb18add1d22722cc75f72d2ab">prev_values</a> </div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;        <span class="comment">#check all conditions for a topic</span></div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;        <span class="keywordflow">for</span> key, condition <span class="keywordflow">in</span> self.conditions.items():</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;            <span class="keywordflow">try</span>:</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;                <span class="keywordflow">if</span> key == path <span class="keywordflow">and</span> eval(condition):</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;                    self.<a class="code" href="classsrc_1_1trigger__monitor_1_1TriggerMonitor.html#af189f0cdfea82bf9360723807ebb8612">exporting</a> = <span class="keyword">True</span></div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;                    self.<a class="code" href="classsrc_1_1trigger__monitor_1_1TriggerMonitor.html#a59b3c7334c28ef5ca6b8505d626767d7">export</a>(data, path)</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;            <span class="keywordflow">except</span> Exception <span class="keyword">as</span> inst:</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;                self.<a class="code" href="classsrc_1_1trigger__monitor_1_1TriggerMonitor.html#aef60b650bc0bfbd432eadf3aa9c3ae23">formatted_log</a>(<span class="stringliteral">&#39;w&#39;</span>, str(type(inst)) + <span class="stringliteral">&#39; &#39;</span> + str(inst))</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;        self.<a class="code" href="classsrc_1_1trigger__monitor_1_1TriggerMonitor.html#af189f0cdfea82bf9360723807ebb8612">exporting</a> = <span class="keyword">False</span></div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    <span class="comment">## Returns the result of the get_available_range ROS service</span></div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    <span class="comment"># @return The result of the get_available_range ROS service</span></div><div class="line"><a name="l00157"></a><span class="lineno"><a class="line" href="classsrc_1_1trigger__monitor_1_1TriggerMonitor.html#a0cbc46e29931bfd6e8a805c97b3f3c41">  157</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classsrc_1_1trigger__monitor_1_1TriggerMonitor.html#a0cbc46e29931bfd6e8a805c97b3f3c41">call_get_available_range</a>(self):</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;        <span class="keywordflow">return</span> rospy.ServiceProxy(<span class="stringliteral">&#39;/black_box/get_available_range&#39;</span>, GetAvailableRange)()</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    <span class="comment">## Returns the result of the export ROS service</span></div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    <span class="comment"># @return The result of the export ROS service</span></div><div class="line"><a name="l00162"></a><span class="lineno"><a class="line" href="classsrc_1_1trigger__monitor_1_1TriggerMonitor.html#a4121c8e597aaade8d97f770f8832e086">  162</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classsrc_1_1trigger__monitor_1_1TriggerMonitor.html#a4121c8e597aaade8d97f770f8832e086">call_export</a>(self, begin, end):</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;        <span class="keywordflow">return</span> rospy.ServiceProxy(<span class="stringliteral">&#39;/black_box/export&#39;</span>, Export)(begin, end)</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    <span class="comment">## Calls the upload service</span></div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    <span class="comment">#</span></div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    <span class="comment"># @param file_name The name of the file</span></div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    <span class="comment"># @param data The new value of the topic</span></div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    <span class="comment"># @param path The path of the topic</span></div><div class="line"><a name="l00170"></a><span class="lineno"><a class="line" href="classsrc_1_1trigger__monitor_1_1TriggerMonitor.html#a59a67da06539c504849383b0ff7230e6">  170</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classsrc_1_1trigger__monitor_1_1TriggerMonitor.html#a59a67da06539c504849383b0ff7230e6">call_upload</a>(self, file_name, data, path):</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;        rospy.ServiceProxy(<span class="stringliteral">&#39;/cloud_uploader/upload&#39;</span>, Upload)(file_name, ujson.dumps(data), path)</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    <span class="comment">## Publishes the trigger event data</span></div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    <span class="comment">#</span></div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    <span class="comment"># @param file_name The name of the file</span></div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    <span class="comment"># @param path The path of the topic</span></div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    <span class="comment"># @param data The new value of the topic</span></div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    <span class="comment"># @param begin The begin of the exported data</span></div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    <span class="comment"># @param end The end of the exported data</span></div><div class="line"><a name="l00180"></a><span class="lineno"><a class="line" href="classsrc_1_1trigger__monitor_1_1TriggerMonitor.html#a41e0c7aa7b3a8606c06f824110fdc4e6">  180</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classsrc_1_1trigger__monitor_1_1TriggerMonitor.html#a41e0c7aa7b3a8606c06f824110fdc4e6">publish_trigger</a>(self, file_name, path, data, begin, end):</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;        self.trigger_publisher.publish(</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;                Trigger( </div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;                    filename = file_name, </div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;                    topic = path,</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;                    json = ujson.dumps(data),</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;                    start = begin,</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;                    end = end</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;            ))</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    <span class="comment">## Exports the data of the topic change</span></div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    <span class="comment">#</span></div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    <span class="comment"># @param data The value of the topic</span></div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    <span class="comment"># @param path The path of the topic</span></div><div class="line"><a name="l00194"></a><span class="lineno"><a class="line" href="classsrc_1_1trigger__monitor_1_1TriggerMonitor.html#a59b3c7334c28ef5ca6b8505d626767d7">  194</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classsrc_1_1trigger__monitor_1_1TriggerMonitor.html#a59b3c7334c28ef5ca6b8505d626767d7">export</a>(self, data, path):</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;        self.<a class="code" href="classsrc_1_1trigger__monitor_1_1TriggerMonitor.html#aef60b650bc0bfbd432eadf3aa9c3ae23">formatted_log</a>(<span class="stringliteral">&#39;i&#39;</span>, <span class="stringliteral">&quot;Triggered: {0}, value: {1}&quot;</span>.format(path, data))</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;        <span class="comment">#get range</span></div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;        range_res = self.<a class="code" href="classsrc_1_1trigger__monitor_1_1TriggerMonitor.html#a0cbc46e29931bfd6e8a805c97b3f3c41">call_get_available_range</a>()</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;        </div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;        <span class="comment">#parsed ranges</span></div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;        export_begin = max(range_res.begin, int(range_res.end - self.<a class="code" href="classsrc_1_1trigger__monitor_1_1TriggerMonitor.html#aed94d467c566932243267543baa21bfc">bag_from</a>))</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;        export_end = int(range_res.end + self.<a class="code" href="classsrc_1_1trigger__monitor_1_1TriggerMonitor.html#aec3e3606d2ab0e22d517ae990bfc6a41">bag_to</a>)</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;        <span class="comment">#wait N sec after the trigger to export    </span></div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;        time.sleep(self.<a class="code" href="classsrc_1_1trigger__monitor_1_1TriggerMonitor.html#aec3e3606d2ab0e22d517ae990bfc6a41">bag_to</a>)</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;        <span class="comment">#start export</span></div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;        exp_res = self.<a class="code" href="classsrc_1_1trigger__monitor_1_1TriggerMonitor.html#a4121c8e597aaade8d97f770f8832e086">call_export</a>(export_begin, export_end)</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;        <span class="comment">#rospy.loginfo(&quot;[ INFO] [ BBU - {3}] Export response: {0}, from: {1}, to: {2}&quot;.format(exp_res, export_begin, export_end, time.time()))</span></div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;        <span class="keywordflow">if</span> (exp_res.file_name == <span class="stringliteral">&quot;&quot;</span>):</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;            self.<a class="code" href="classsrc_1_1trigger__monitor_1_1TriggerMonitor.html#aef60b650bc0bfbd432eadf3aa9c3ae23">formatted_log</a>(<span class="stringliteral">&#39;w&#39;</span>, <span class="stringliteral">&quot;The export failed, nothing to upload ({0} - {1}).&quot;</span>.format(export_begin, export_end))</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;            self.<a class="code" href="classsrc_1_1trigger__monitor_1_1TriggerMonitor.html#a41e0c7aa7b3a8606c06f824110fdc4e6">publish_trigger</a>(exp_res.file_name, path, data, export_begin, export_end)</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;            <span class="keywordflow">try</span>:</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;                self.<a class="code" href="classsrc_1_1trigger__monitor_1_1TriggerMonitor.html#a59a67da06539c504849383b0ff7230e6">call_upload</a>(exp_res.file_name, data, path)</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;            <span class="keywordflow">except</span> rospy.ServiceException <span class="keyword">as</span> inst:</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;                    self.<a class="code" href="classsrc_1_1trigger__monitor_1_1TriggerMonitor.html#aef60b650bc0bfbd432eadf3aa9c3ae23">formatted_log</a>(<span class="stringliteral">&#39;w&#39;</span>, str(type(inst)) + <span class="stringliteral">&#39; &#39;</span> + str(inst))</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    <span class="comment">## Tries to subscribe to a topic</span></div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    <span class="comment">#</span></div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    <span class="comment"># The subscribtion will be done, if the topic is presented so ROS can provide its type.</span></div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    <span class="comment"># @param path The path of the topic</span></div><div class="line"><a name="l00225"></a><span class="lineno"><a class="line" href="classsrc_1_1trigger__monitor_1_1TriggerMonitor.html#a242211fc91b5759f112e75c1db722d44">  225</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classsrc_1_1trigger__monitor_1_1TriggerMonitor.html#a242211fc91b5759f112e75c1db722d44">try_subscribe</a>(self, path):</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;        <span class="comment">#dynamically get the topic type</span></div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;        data_type = rostopic.get_topic_type(path, blocking=<span class="keyword">False</span>)[0]</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;        <span class="keywordflow">if</span> data_type:</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;            data_class = roslib.message.get_message_class(data_type)</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;            <span class="comment">#subscribe to the topic</span></div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;            rospy.Subscriber(path, data_class, callback = self.<a class="code" href="classsrc_1_1trigger__monitor_1_1TriggerMonitor.html#ac57a319967a575d82e792adb34a9d6e8">variable_changed</a>, callback_args = path)</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">True</span></div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">False</span></div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    <span class="comment">## Subscribes to a topic</span></div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    <span class="comment">#</span></div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    <span class="comment"># If the topic is not advertised by the time of starting this method, it will keep trying indefinitely</span></div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    <span class="comment"># @param path The path of the topic</span></div><div class="line"><a name="l00240"></a><span class="lineno"><a class="line" href="classsrc_1_1trigger__monitor_1_1TriggerMonitor.html#ae72a905eb232762eeaef73a9b89a4e47">  240</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classsrc_1_1trigger__monitor_1_1TriggerMonitor.html#ae72a905eb232762eeaef73a9b89a4e47">subscribe</a>(self, path):</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;        hz = rospy.Rate(10)</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;        <span class="keywordflow">while</span> <span class="keywordflow">not</span> self.<a class="code" href="classsrc_1_1trigger__monitor_1_1TriggerMonitor.html#a242211fc91b5759f112e75c1db722d44">try_subscribe</a>(path) <span class="keywordflow">and</span> <span class="keywordflow">not</span> rospy.is_shutdown():</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;            <span class="comment"># rospy.loginfo(&quot;%s not presented, wait...&quot;%(path))</span></div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;            hz.sleep()</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    <span class="comment">## Starts the node</span></div><div class="line"><a name="l00248"></a><span class="lineno"><a class="line" href="classsrc_1_1trigger__monitor_1_1TriggerMonitor.html#a39154f1e0299188630e9285b7effe393">  248</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classsrc_1_1trigger__monitor_1_1TriggerMonitor.html#a39154f1e0299188630e9285b7effe393">start</a>(self):</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;        self.<a class="code" href="classsrc_1_1trigger__monitor_1_1TriggerMonitor.html#a748846959b7547788b60fb48293636b1">load_config</a>()</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;        </div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;        <span class="comment">#do not listen if black_box node is not running</span></div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;        rospy.wait_for_service(<span class="stringliteral">&#39;/black_box/get_available_range&#39;</span>)</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;        </div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;        <span class="comment">## Topic to publish triggered events</span></div><div class="line"><a name="l00255"></a><span class="lineno"><a class="line" href="classsrc_1_1trigger__monitor_1_1TriggerMonitor.html#a5074f6e2efdc4b801e26031e72b72d46">  255</a></span>&#160;        self.<a class="code" href="classsrc_1_1trigger__monitor_1_1TriggerMonitor.html#a5074f6e2efdc4b801e26031e72b72d46">trigger_publisher</a> = rospy.Publisher(<span class="stringliteral">&quot;trigger&quot;</span>, Trigger, latch=<span class="keyword">True</span>, queue_size=1)</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;        <span class="comment">#read subscribes</span></div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;        <span class="keywordflow">for</span> path, condition <span class="keywordflow">in</span> self.conditions.items():</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;            <span class="comment">#subscribe to each topic on a different thread, thus: if some topic is not presented</span></div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;            <span class="comment">#we can listen for the others</span></div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;            t = Thread(target = self.<a class="code" href="classsrc_1_1trigger__monitor_1_1TriggerMonitor.html#ae72a905eb232762eeaef73a9b89a4e47">subscribe</a>, args = (path,))</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;            t.start()</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    </div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;        <span class="comment">#keep running</span></div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;        rospy.spin()</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    </div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;<span class="keywordflow">if</span> __name__ == <span class="stringliteral">&#39;__main__&#39;</span>:</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    <span class="keywordflow">try</span>:</div><div class="line"><a name="l00269"></a><span class="lineno"><a class="line" href="namespacesrc_1_1trigger__monitor.html#a049c84f93448f91a1f329a5a7fd0e103">  269</a></span>&#160;        rospy.init_node(<span class="stringliteral">&#39;trigger_monitor&#39;</span>, anonymous=<span class="keyword">False</span>)</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;</div><div class="line"><a name="l00271"></a><span class="lineno"><a class="line" href="namespacesrc_1_1trigger__monitor.html#a8e06bd2f3c027156c890ccdba1befed1">  271</a></span>&#160;        tm = <a class="code" href="classsrc_1_1trigger__monitor_1_1TriggerMonitor.html">TriggerMonitor</a>()</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;        tm.start()</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    <span class="keywordflow">except</span> Exception <span class="keyword">as</span> inst:</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;        rospy.logerr(<span class="stringliteral">&#39;[BBU] &#39;</span> + str(type(inst)) + <span class="stringliteral">&#39; &#39;</span> + str(inst))</div><div class="ttc" id="classsrc_1_1trigger__monitor_1_1TriggerMonitor_html_ae72a905eb232762eeaef73a9b89a4e47"><div class="ttname"><a href="classsrc_1_1trigger__monitor_1_1TriggerMonitor.html#ae72a905eb232762eeaef73a9b89a4e47">src.trigger_monitor.TriggerMonitor.subscribe</a></div><div class="ttdeci">def subscribe(self, path)</div><div class="ttdoc">Subscribes to a topic. </div><div class="ttdef"><b>Definition:</b> <a href="trigger__monitor_8py_source.html#l00240">trigger_monitor.py:240</a></div></div>
<div class="ttc" id="classsrc_1_1trigger__monitor_1_1TriggerMonitor_html_a39154f1e0299188630e9285b7effe393"><div class="ttname"><a href="classsrc_1_1trigger__monitor_1_1TriggerMonitor.html#a39154f1e0299188630e9285b7effe393">src.trigger_monitor.TriggerMonitor.start</a></div><div class="ttdeci">def start(self)</div><div class="ttdoc">Starts the node. </div><div class="ttdef"><b>Definition:</b> <a href="trigger__monitor_8py_source.html#l00248">trigger_monitor.py:248</a></div></div>
<div class="ttc" id="classsrc_1_1trigger__monitor_1_1TriggerMonitor_html_a7a0fc158ec32eac325de693a7fce8a07"><div class="ttname"><a href="classsrc_1_1trigger__monitor_1_1TriggerMonitor.html#a7a0fc158ec32eac325de693a7fce8a07">src.trigger_monitor.TriggerMonitor.__init__</a></div><div class="ttdeci">def __init__(self)</div><div class="ttdef"><b>Definition:</b> <a href="trigger__monitor_8py_source.html#l00057">trigger_monitor.py:57</a></div></div>
<div class="ttc" id="classsrc_1_1trigger__monitor_1_1TriggerMonitor_html_a59b3c7334c28ef5ca6b8505d626767d7"><div class="ttname"><a href="classsrc_1_1trigger__monitor_1_1TriggerMonitor.html#a59b3c7334c28ef5ca6b8505d626767d7">src.trigger_monitor.TriggerMonitor.export</a></div><div class="ttdeci">def export(self, data, path)</div><div class="ttdoc">Exports the data of the topic change. </div><div class="ttdef"><b>Definition:</b> <a href="trigger__monitor_8py_source.html#l00194">trigger_monitor.py:194</a></div></div>
<div class="ttc" id="classsrc_1_1trigger__monitor_1_1TriggerMonitor_html_aea3a65401bddc98488e90bea57dc4308"><div class="ttname"><a href="classsrc_1_1trigger__monitor_1_1TriggerMonitor.html#aea3a65401bddc98488e90bea57dc4308">src.trigger_monitor.TriggerMonitor.bag_path</a></div><div class="ttdeci">bag_path</div><div class="ttdoc">The path where the bag files are stored. </div><div class="ttdef"><b>Definition:</b> <a href="trigger__monitor_8py_source.html#l00105">trigger_monitor.py:105</a></div></div>
<div class="ttc" id="classsrc_1_1trigger__monitor_1_1TriggerMonitor_html_ac57a319967a575d82e792adb34a9d6e8"><div class="ttname"><a href="classsrc_1_1trigger__monitor_1_1TriggerMonitor.html#ac57a319967a575d82e792adb34a9d6e8">src.trigger_monitor.TriggerMonitor.variable_changed</a></div><div class="ttdeci">def variable_changed(self, data, path)</div><div class="ttdoc">Saves a bag file and notify the users. </div><div class="ttdef"><b>Definition:</b> <a href="trigger__monitor_8py_source.html#l00114">trigger_monitor.py:114</a></div></div>
<div class="ttc" id="classsrc_1_1trigger__monitor_1_1TriggerMonitor_html_a6bb1015a2afd175d93eb44c6a1a3b05c"><div class="ttname"><a href="classsrc_1_1trigger__monitor_1_1TriggerMonitor.html#a6bb1015a2afd175d93eb44c6a1a3b05c">src.trigger_monitor.TriggerMonitor.node_id</a></div><div class="ttdeci">node_id</div><div class="ttdoc">The id of the node, used in logs. </div><div class="ttdef"><b>Definition:</b> <a href="trigger__monitor_8py_source.html#l00059">trigger_monitor.py:59</a></div></div>
<div class="ttc" id="classsrc_1_1trigger__monitor_1_1TriggerMonitor_html_a151b385bb18add1d22722cc75f72d2ab"><div class="ttname"><a href="classsrc_1_1trigger__monitor_1_1TriggerMonitor.html#a151b385bb18add1d22722cc75f72d2ab">src.trigger_monitor.TriggerMonitor.prev_values</a></div><div class="ttdeci">prev_values</div><div class="ttdoc">Previous values dictionary. </div><div class="ttdef"><b>Definition:</b> <a href="trigger__monitor_8py_source.html#l00065">trigger_monitor.py:65</a></div></div>
<div class="ttc" id="classsrc_1_1trigger__monitor_1_1TriggerMonitor_html_a79a4335122bfccecf669bd88ca4a8903"><div class="ttname"><a href="classsrc_1_1trigger__monitor_1_1TriggerMonitor.html#a79a4335122bfccecf669bd88ca4a8903">src.trigger_monitor.TriggerMonitor.conditions</a></div><div class="ttdeci">conditions</div><div class="ttdoc">Dictionary of conditions. </div><div class="ttdef"><b>Definition:</b> <a href="trigger__monitor_8py_source.html#l00061">trigger_monitor.py:61</a></div></div>
<div class="ttc" id="classsrc_1_1trigger__monitor_1_1TriggerMonitor_html_a0cbc46e29931bfd6e8a805c97b3f3c41"><div class="ttname"><a href="classsrc_1_1trigger__monitor_1_1TriggerMonitor.html#a0cbc46e29931bfd6e8a805c97b3f3c41">src.trigger_monitor.TriggerMonitor.call_get_available_range</a></div><div class="ttdeci">def call_get_available_range(self)</div><div class="ttdoc">Returns the result of the get_available_range ROS service. </div><div class="ttdef"><b>Definition:</b> <a href="trigger__monitor_8py_source.html#l00157">trigger_monitor.py:157</a></div></div>
<div class="ttc" id="classsrc_1_1trigger__monitor_1_1TriggerMonitor_html_a242211fc91b5759f112e75c1db722d44"><div class="ttname"><a href="classsrc_1_1trigger__monitor_1_1TriggerMonitor.html#a242211fc91b5759f112e75c1db722d44">src.trigger_monitor.TriggerMonitor.try_subscribe</a></div><div class="ttdeci">def try_subscribe(self, path)</div><div class="ttdoc">Tries to subscribe to a topic. </div><div class="ttdef"><b>Definition:</b> <a href="trigger__monitor_8py_source.html#l00225">trigger_monitor.py:225</a></div></div>
<div class="ttc" id="classsrc_1_1trigger__monitor_1_1TriggerMonitor_html_aef60b650bc0bfbd432eadf3aa9c3ae23"><div class="ttname"><a href="classsrc_1_1trigger__monitor_1_1TriggerMonitor.html#aef60b650bc0bfbd432eadf3aa9c3ae23">src.trigger_monitor.TriggerMonitor.formatted_log</a></div><div class="ttdeci">def formatted_log(self, type, msg)</div><div class="ttdoc">Formats a log message. </div><div class="ttdef"><b>Definition:</b> <a href="trigger__monitor_8py_source.html#l00073">trigger_monitor.py:73</a></div></div>
<div class="ttc" id="classsrc_1_1trigger__monitor_1_1TriggerMonitor_html_af189f0cdfea82bf9360723807ebb8612"><div class="ttname"><a href="classsrc_1_1trigger__monitor_1_1TriggerMonitor.html#af189f0cdfea82bf9360723807ebb8612">src.trigger_monitor.TriggerMonitor.exporting</a></div><div class="ttdeci">exporting</div><div class="ttdoc">True, if an export operation is ongoing. </div><div class="ttdef"><b>Definition:</b> <a href="trigger__monitor_8py_source.html#l00063">trigger_monitor.py:63</a></div></div>
<div class="ttc" id="classsrc_1_1trigger__monitor_1_1TriggerMonitor_html_a748846959b7547788b60fb48293636b1"><div class="ttname"><a href="classsrc_1_1trigger__monitor_1_1TriggerMonitor.html#a748846959b7547788b60fb48293636b1">src.trigger_monitor.TriggerMonitor.load_config</a></div><div class="ttdeci">def load_config(self)</div><div class="ttdoc">Loads and checks the config values from rosparam. </div><div class="ttdef"><b>Definition:</b> <a href="trigger__monitor_8py_source.html#l00081">trigger_monitor.py:81</a></div></div>
<div class="ttc" id="classsrc_1_1trigger__monitor_1_1TriggerMonitor_html_a5074f6e2efdc4b801e26031e72b72d46"><div class="ttname"><a href="classsrc_1_1trigger__monitor_1_1TriggerMonitor.html#a5074f6e2efdc4b801e26031e72b72d46">src.trigger_monitor.TriggerMonitor.trigger_publisher</a></div><div class="ttdeci">trigger_publisher</div><div class="ttdoc">Topic to publish triggered events. </div><div class="ttdef"><b>Definition:</b> <a href="trigger__monitor_8py_source.html#l00255">trigger_monitor.py:255</a></div></div>
<div class="ttc" id="classsrc_1_1trigger__monitor_1_1TriggerMonitor_html_adba2e74b17219ce7845f123f6dc07b4c"><div class="ttname"><a href="classsrc_1_1trigger__monitor_1_1TriggerMonitor.html#adba2e74b17219ce7845f123f6dc07b4c">src.trigger_monitor.TriggerMonitor.trigger_delay</a></div><div class="ttdeci">trigger_delay</div><div class="ttdoc">The minimum time required to register a new trigger. </div><div class="ttdef"><b>Definition:</b> <a href="trigger__monitor_8py_source.html#l00099">trigger_monitor.py:99</a></div></div>
<div class="ttc" id="classsrc_1_1trigger__monitor_1_1TriggerMonitor_html_a9005ca161e52ab93688cb46ad31db4ef"><div class="ttname"><a href="classsrc_1_1trigger__monitor_1_1TriggerMonitor.html#a9005ca161e52ab93688cb46ad31db4ef">src.trigger_monitor.TriggerMonitor.on_change_only</a></div><div class="ttdeci">on_change_only</div><div class="ttdoc">If true, triggers will happen only when the value of the topic has changed. </div><div class="ttdef"><b>Definition:</b> <a href="trigger__monitor_8py_source.html#l00097">trigger_monitor.py:97</a></div></div>
<div class="ttc" id="classsrc_1_1trigger__monitor_1_1TriggerMonitor_html_a41e0c7aa7b3a8606c06f824110fdc4e6"><div class="ttname"><a href="classsrc_1_1trigger__monitor_1_1TriggerMonitor.html#a41e0c7aa7b3a8606c06f824110fdc4e6">src.trigger_monitor.TriggerMonitor.publish_trigger</a></div><div class="ttdeci">def publish_trigger(self, file_name, path, data, begin, end)</div><div class="ttdoc">Publishes the trigger event data. </div><div class="ttdef"><b>Definition:</b> <a href="trigger__monitor_8py_source.html#l00180">trigger_monitor.py:180</a></div></div>
<div class="ttc" id="classsrc_1_1trigger__monitor_1_1TriggerMonitor_html_a59a67da06539c504849383b0ff7230e6"><div class="ttname"><a href="classsrc_1_1trigger__monitor_1_1TriggerMonitor.html#a59a67da06539c504849383b0ff7230e6">src.trigger_monitor.TriggerMonitor.call_upload</a></div><div class="ttdeci">def call_upload(self, file_name, data, path)</div><div class="ttdoc">Calls the upload service. </div><div class="ttdef"><b>Definition:</b> <a href="trigger__monitor_8py_source.html#l00170">trigger_monitor.py:170</a></div></div>
<div class="ttc" id="classsrc_1_1trigger__monitor_1_1TriggerMonitor_html_a4121c8e597aaade8d97f770f8832e086"><div class="ttname"><a href="classsrc_1_1trigger__monitor_1_1TriggerMonitor.html#a4121c8e597aaade8d97f770f8832e086">src.trigger_monitor.TriggerMonitor.call_export</a></div><div class="ttdeci">def call_export(self, begin, end)</div><div class="ttdoc">Returns the result of the export ROS service. </div><div class="ttdef"><b>Definition:</b> <a href="trigger__monitor_8py_source.html#l00162">trigger_monitor.py:162</a></div></div>
<div class="ttc" id="classsrc_1_1trigger__monitor_1_1TriggerMonitor_html_a4024c3e42ed99ab988d9aba40269ce6c"><div class="ttname"><a href="classsrc_1_1trigger__monitor_1_1TriggerMonitor.html#a4024c3e42ed99ab988d9aba40269ce6c">src.trigger_monitor.TriggerMonitor.prev_change</a></div><div class="ttdeci">prev_change</div><div class="ttdoc">Previous change times dictionary. </div><div class="ttdef"><b>Definition:</b> <a href="trigger__monitor_8py_source.html#l00067">trigger_monitor.py:67</a></div></div>
<div class="ttc" id="classsrc_1_1trigger__monitor_1_1TriggerMonitor_html_aec3e3606d2ab0e22d517ae990bfc6a41"><div class="ttname"><a href="classsrc_1_1trigger__monitor_1_1TriggerMonitor.html#aec3e3606d2ab0e22d517ae990bfc6a41">src.trigger_monitor.TriggerMonitor.bag_to</a></div><div class="ttdeci">bag_to</div><div class="ttdoc">How many seconds after the event should be exported. </div><div class="ttdef"><b>Definition:</b> <a href="trigger__monitor_8py_source.html#l00103">trigger_monitor.py:103</a></div></div>
<div class="ttc" id="classsrc_1_1trigger__monitor_1_1TriggerMonitor_html_aed94d467c566932243267543baa21bfc"><div class="ttname"><a href="classsrc_1_1trigger__monitor_1_1TriggerMonitor.html#aed94d467c566932243267543baa21bfc">src.trigger_monitor.TriggerMonitor.bag_from</a></div><div class="ttdeci">bag_from</div><div class="ttdoc">How many seconds before the event should be exported. </div><div class="ttdef"><b>Definition:</b> <a href="trigger__monitor_8py_source.html#l00101">trigger_monitor.py:101</a></div></div>
<div class="ttc" id="classsrc_1_1trigger__monitor_1_1TriggerMonitor_html"><div class="ttname"><a href="classsrc_1_1trigger__monitor_1_1TriggerMonitor.html">src.trigger_monitor.TriggerMonitor</a></div><div class="ttdoc">Handles events and triggers exports based on set conditions. </div><div class="ttdef"><b>Definition:</b> <a href="trigger__monitor_8py_source.html#l00055">trigger_monitor.py:55</a></div></div>
</div><!-- fragment --></div><!-- contents -->

<br clear="all" />
<hr size="1"><div style="align: right;">
<a href="http://wiki.ros.org/main">main</a><br />
Author(s): </br />
<small>autogenerated on Tue Dec 3 2019 16:02:36</small>
</div>
</body>
</html>
